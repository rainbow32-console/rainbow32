<!--
MIT License

Copyright (c) 2023 rainbow32-console

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script>"use strict";(()=>{var Ut=Object.defineProperty;var et=(e,t)=>{for(var n in t)Ut(e,n,{get:t[n],enumerable:!0})};var Oe={};et(Oe,{getFrequency:()=>oe,getInstrumentSoundFunction:()=>re,getSound:()=>le,loadMusic:()=>Ee,parseAudio:()=>Bt,playAudio:()=>Wt,playSound:()=>Vt,serializeAudio:()=>Ot,soundToUint8:()=>it,unloadMusic:()=>Be,unserializeAudio:()=>Nt,validInstruments:()=>H,validNotes:()=>ot});var tt=[{C:16.35,"C#":17.32,D:18.35,"D#":19.45,E:20.6,F:21.83,"F#":23.12,G:24.5,"G#":25.96,A:27.5,"A#":29.14,B:30.87},{C:32.7,"C#":34.65,D:36.71,"D#":38.89,E:41.2,F:43.65,"F#":46.25,G:49,"G#":51.91,A:55,"A#":58.27,B:61.74},{C:65.41,"C#":69.3,D:73.42,"D#":77.78,E:82.41,F:87.31,"F#":92.5,G:98,"G#":103.83,A:110,"A#":116.54,B:123.47},{C:130.81,"C#":138.59,D:146.83,"D#":155.56,E:164.81,F:174.61,"F#":185,G:196,"G#":207.65,A:220,"A#":233.08,B:246.94},{C:261.63,"C#":277.18,D:293.66,"D#":311.13,E:329.63,F:349.2,"F#":369.9,G:392,"G#":415.3,A:440,"A#":466.1,B:493.8},{C:523.2,"C#":554.3,D:587.3,"D#":622.2,E:659.2,F:698.4,"F#":739.9,G:783.9,"G#":830.6,A:880,"A#":932.3,B:987.7},{C:1046.5,"C#":1108.7,D:1174.6,"D#":1244.5,E:1318.5,F:1396.9,"F#":1479.9,G:1567.9,"G#":1661.2,A:1760,"A#":1864.6,B:1975.5},{C:2093,"C#":2217.4,D:2349.3,"D#":2489,E:2637,F:2793.8,"F#":2959.9,G:3135.9,"G#":3322.4,A:3520,"A#":3729.3,B:3951},{C:4186,"C#":4434.9,D:4698.6,"D#":4978,E:5274,F:5587.6,"F#":5919.9,G:6271.9,"G#":6644.8,A:7040,"A#":7458.6,B:7902.1}];function we(e,t){return fetch(e).then(n=>n.blob()).then(n=>{let o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=t,o.click(),URL.revokeObjectURL(o.href)}).catch(console.error)}var Ue={};function nt(e){return!!Ue[e]}function rt(e,t){Ue[e]=!0,setTimeout(()=>Ue[e]=!1,t)}function ye(e){return new Promise(t=>setTimeout(t,e))}var ot=["a","b","c","d","e","f","g"],H=["square-wave","sine-wave","triangle-wave","sawtooth-wave","noise","gfx0","gfx1","gfx2","gfx3","gfx4","gfx5","gfx6","gfx7","gfx8","gfx9","gfx10"];function ve(e){if(e==="   ")return 0;if(!ot.includes(e[0]))throw new Error("Invalid State: Note is not valid ("+e[0]+")");let t=Number(e[1]);if(isNaN(t)||t<0||t>8)throw new Error("Invalid State: Octave is out-of-bounds or NaN ("+t+")");return it({sound:e[0],octave:t,halfToneStepUp:e[2]==="#"})}function Bt(e){let t=0,n="";for(;e[t];){if(e[t]===":")break;n+=e[t++]}if(e[t++]!==":")throw new Error("Error while parsing length: Expected number or `:`, but found undefined");let o=Number(n);if(isNaN(o))throw new Error("Error whilst parsing length: Length is not a number");if(!isFinite(o))throw new Error("Error whilst parsing length: Length is not finite");if(o>255||o<0)throw new Error("Error whilst parsing length: Length is not 0-255");let i=0,s=[],a="";for(;e[t];){if(e[t]!==":")a+=e[t];else{if(!H.includes(a))throw new Error("Invalid Instrument: "+a);if(s.push(a),i++,a="",i>3)break}t++}if(e[t++]!==":")throw new Error("Invalid State: Failed to parse instrument "+(i+1)+": Expected `:`, but found nothing");let l=e.indexOf(":",t),u=e.indexOf(":",l+1),c=e.indexOf(":",u+1);if(l===-1)throw new Error("Invalid State: Failed to parse sounds for channel1: Expected `:` but found nothing");if(u===-1)throw new Error("Invalid State: Failed to parse sounds for channel2: Expected `:` but found nothing");if(c===-1)throw new Error("Invalid State: Failed to parse sounds for channel3: Expected `:` but found nothing");let g=e.substring(t,l),d=e.substring(l+1,u),E=e.substring(u+1,c),M=e.substring(c+1,e.length);if(g.length%3!==0)throw new Error("Length of sounds for channel 1 is not a multiple of 3");if(d.length%3!==0)throw new Error("Length of sounds for channel 2 is not a multiple of 3");if(E.length%3!==0)throw new Error("Length of sounds for channel 3 is not a multiple of 3");if(M.length%3!==0)throw new Error("Length of sounds for channel 4 is not a multiple of 3");let N=new Uint8Array(o),W=new Uint8Array(o),L=new Uint8Array(o),T=new Uint8Array(o);for(let b=0;b<o;++b)g[b*3]&&(N[b]=ve(g.substring(b*3,b*3+3))),d[b*3]&&(W[b]=ve(d.substring(b*3,b*3+3))),E[b*3]&&(L[b]=ve(E.substring(b*3,b*3+3))),M[b*3]&&(T[b]=ve(M.substring(b*3,b*3+3)));return{length:o,channel1:N,channel2:W,channel3:L,channel4:T,channel1Instrument:s[0],channel2Instrument:s[1],channel3Instrument:s[2],channel4Instrument:s[3]}}function le(e){let t=(e&224)>>5,n=((e&30)>>1)-1,o=!!(e&1);if(!(t<0||t>6)&&!(n<0||n>8))return{halfToneStepUp:o,octave:n,sound:String.fromCharCode(97+t)}}function it(e){return e.sound.charCodeAt(0)-97<<5|e.octave+1<<1|(e.halfToneStepUp?1:0)}function Ot(e){let t=new Uint8Array(e.length*4+3);t[0]=e.length,t[1]=H.indexOf(e.channel1Instrument)<<4|H.indexOf(e.channel2Instrument),t[2]=H.indexOf(e.channel3Instrument)<<4|H.indexOf(e.channel4Instrument);for(let n=0;n<e.length;++n)t[n+3]=e.channel1[n],t[n*2+3]=e.channel2[n],t[n*3+3]=e.channel3[n],t[n*4+3]=e.channel4[n];return t}function Nt(e){if(e.length<3)throw new Error("Array too little (has to be at least 3 bytes)");let t=e[0];if(e.length!==t*4+3)throw new Error("Array does not have enough space to house all the channel data");return{length:t,channel1Instrument:H[(e[1]&15)>>4],channel2Instrument:H[e[1]&15],channel3Instrument:H[(e[1]&15)>>4],channel4Instrument:H[e[1]&15],channel1:e.subarray(t+3,t*2+2),channel2:e.subarray(t*2+3,t*3+2),channel3:e.subarray(t*3+3,t*4+2),channel4:e.subarray(t*4+3,t*5+2)}}function jt(e,t,n){return xe(e,t,n,"square")}function Ht(e,t,n){return xe(e,t,n,"sine")}function qt(e,t,n){return xe(e,t,n,"sawtooth")}function zt(e,t,n){return xe(e,t,n,"triangle")}var G=new AudioContext;function xe(e,t,n,o){if(G.state!=="running")return new Promise((a,l)=>l(new Error("Audiocontext is closed!")));let i=new OscillatorNode(G,{type:o,frequency:t}),s=G.createGain();return s.gain.value=e,s.connect(G.destination),i.connect(s),i.start(0),setTimeout(()=>{i.stop(),i.disconnect(),s.disconnect()},n*1e3),ye(n*1e3)}function $t(e,t,n){if(G.state!=="running")return new Promise((c,g)=>g(new Error("Audiocontext is closed!")));let o=G.sampleRate*n,i=new AudioBuffer({length:o,sampleRate:G.sampleRate}),s=i.getChannelData(0);for(let c=0;c<o;c++)s[c]=Math.random()*2-1;let a=new AudioBufferSourceNode(G,{buffer:i}),l=new BiquadFilterNode(G,{type:"bandpass",frequency:t+300}),u=G.createGain();return u.gain.value=e,u.connect(G.destination),a.connect(l).connect(u),a.start(0),setTimeout(()=>{a.stop(),a.disconnect(),u.disconnect()},n*1e3),ye(n*1e3)}function re(e){if(e.startsWith("gfx"))throw new Error("GFX isn't supported yet!");if(e==="triangle-wave")return zt;if(e==="square-wave")return jt;if(e==="sine-wave")return Ht;if(e==="sawtooth-wave")return qt;if(e==="noise")return $t;throw new Error("Cannot play instrument "+e)}function oe(e){return tt[e.octave][e.sound.toUpperCase()+(e.halfToneStepUp?"#":"")]}function Vt(e,t,n,o){return re(t)(n,oe(e),o)}async function Wt(e,t,n){let o=re(e.channel1Instrument),i=re(e.channel2Instrument),s=re(e.channel3Instrument),a=re(e.channel4Instrument);for(let l=0;l<e.length;++l){let u=le(e.channel1[l]),c=le(e.channel2[l]),g=le(e.channel3[l]),d=le(e.channel4[l]);u&&o(n,oe(u),t),c&&i(n,oe(c),t),g&&s(n,oe(g),t),d&&a(n,oe(d),t),await ye(t*1e3)}}function Be(){G.suspend()}async function Ee(){if(G.state==="suspended")try{return await G.resume()}catch{}}var We={};et(We,{applyImageMask:()=>ue,applyImageMaskModifyImage:()=>Jt,circle:()=>e0,defaultPalette:()=>at,getColor:()=>je,getCurrentPalette:()=>Zt,imgToPng:()=>Qt,isDirty:()=>Q,isValidColor:()=>ze,markAsDirty:()=>Ve,parseImage:()=>He,parseMask:()=>r,putImage:()=>Y,putImageRaw:()=>Z,removeDirtyMark:()=>$e,serializeImage:()=>t0,setCurrentPalette:()=>Ne,square:()=>C,stringifyImage:()=>Kt,stringifyMask:()=>Yt,unserializeImage:()=>n0});function st(e,t,n){if(n>1)throw new Error("t cannot be above 1");if(n<0)throw new Error("t cannot be below 0");return e+n*(t-e)}function Ie(e,t){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}var at=["#000000","#00021c","#1c284d","#343473","#2d5280","#4d7a99","#7497a6","#a3ccd9","#f0edd8","#732866","#a6216e","#d94c87","#d9214f","#f25565","#f27961","#993649","#b36159","#f09c60","#b38f24","#b3b324","#f7c93e","#17735f","#119955","#67b31b","#1ba683","#47cca9","#96e3c9","#2469b3","#0b8be6","#0bafe6","#f28d85","#f0bb90"],K=at,Ce=[];for(let e=0;e<K.length;++e)Ce[e]=qe(e,K);function Zt(){return K}function Ne(e){K=e,Ce=[];for(let t=0;t<K.length;++t)Ce[t]=qe(t,K)}function je(e){return Ce[e]}function He(e){let t="",n="",o=!1,i=0;for(;;){let u=e[i++];if(u)if(u===":"){if(o)break;o=!0}else o?n+=u:t+=u;else throw new Error("Could not get width or height!")}let s=Math.floor(Number(t)),a=Math.floor(Number(n));if(isNaN(s)||isNaN(a)||!isFinite(s)||!isFinite(a))throw new Error("width or height is not a number or infinite");let l=new Uint8Array(s*a);for(let u=0;u<a;u++)for(let c=0;c<s;c++)e[i]===" "?l[u*s+c]=255:l[u*s+c]=parseInt(e[i],32),i++;return{buf:l,height:a,width:s}}function qe(e,t){t||=K;let n=t[e];if(!n)throw new Error("The color has to be in the range of 0-31. Supplied "+e);n.startsWith("#")&&(n=n.substring(1));let o=n[0]+n[1],i=n[2]+n[3],s=n[4]+n[5],a=n[6]+n[7],l=0,u=0,c=0,g=255;try{let d=parseInt(o,16);!isNaN(d)&&d>-1&&d<256&&(l=d)}catch{}try{let d=parseInt(i,16);!isNaN(d)&&d>-1&&d<256&&(u=d)}catch{}try{let d=parseInt(s,16);!isNaN(d)&&d>-1&&d<256&&(c=d)}catch{}try{let d=parseInt(a,16);!isNaN(d)&&d>-1&&d<256&&(g||=d)}catch{}return{r:l,g:u,b:c,a:g}}function Xt(e,t){if(e.width<1||e.height<1)return null;let n=new Uint8ClampedArray(e.width*e.height*4);for(let o=0;o<e.height;++o)for(let i=0;i<e.width;++i)if(e.buf[o*e.width+i]===255){let s=(o*e.width+i)*4;n[s]=0,n[s+1]=0,n[s+2]=0,n[s+3]=0}else{let s=qe(e.buf[o*e.width+i],t),a=(o*e.width+i)*4;n[a]=s.r,n[a+1]=s.g,n[a+2]=s.b,n[a+3]=s.a}return new ImageData(n,e.width,e.height)}function r(e){let t="",n="",o=!1,i=0;for(;;){if(e[i]){if(e[i]===":"&&o)break;e[i]===":"?o=!0:o?n+=e[i]:t+=e[i]}else throw new Error("Could not get width or height!");i++}i++;let s=Math.floor(Number(t)),a=Math.floor(Number(n));if(isNaN(s)||isNaN(a)||!isFinite(s)||!isFinite(a))throw new Error("Height or width is not a number or not finite");let l=new Uint8Array(Math.ceil(s*a/8));for(let u=0;u<a;++u)for(let c=0;c<s;++c)l[Math.floor((u*s+c)/8)]|=(e[i++]===" "||e[i-1]==="0"?0:1)<<(u*s+c)%8;return{buf:l,height:a,width:s}}function ue(e,t){if(e.width!==t.width||e.height!==t.height)throw new Error("Width and height dont match!");let n={buf:new Uint8Array(e.buf.length),height:e.height,width:e.width};for(let o=0;o<e.height;++o)for(let i=0;i<e.width;++i){let s=o*e.width+i;t.buf[Math.floor(s/8)]>>s%8&1?n.buf[s]=e.buf[s]:n.buf[s]=255}return n}function Jt(e,t){if(e.width!==t.width||e.height!==t.height)throw new Error("Width and height dont match!");for(let n=0;n<e.height;++n)for(let o=0;o<e.width;++o){let i=n*e.width+o;t.buf[Math.floor(i/8)]>>i%8&1||(e.buf[i]=255)}}function Kt(e){let t=`${e.width}:${e.height}:`;for(let n=0;n<e.buf.length;++n)t+=e.buf[n]===255?" ":e.buf[n].toString(32);return t}function Yt(e){let t=`${e.width}:${e.height}:`;for(let n=0;n<e.height;++n)for(let o=0;o<e.width;++o){let i=n*e.width+o;t+=e.buf[Math.floor(i/8)]>>i%8&1}return t}function Qt(e,t){if(e.width<1||e.height<1)throw new Error("Image is 0x0");let n=document.createElement("canvas");return n.width=e.width,n.height=e.height,n.getContext("2d",{willReadFrequently:!0})?.putImageData(Xt(e),0,0),n.toDataURL(t||"image/png")}function Y(e,t,n){Q=!0,e=Math.floor(e),t=Math.floor(t);for(let o=0;o<n.height;++o)for(let i=0;i<n.width;++i){let s=(o+t)*I+e+i;s>=I*S||n.buf[o*n.width+i]!==255&&(x[s+1]=n.buf[o*n.width+i])}}function Z(e,t,n){Q=!0,e=Math.floor(e),t=Math.floor(t);for(let o=0;o<n.height;++o)for(let i=0;i<n.width;++i){let s=(o+t)*I+e+i;s>=I*S||(x[s+1]=n.buf[o*n.width+i])}}function ze(e){return e>-1&&e<32}function C(e,t,n){if(typeof n=="string"&&(n=parseInt(n,32)),!ze(n))throw new Error("That color is invalid!");let o=new Uint8Array(e*t);for(let i=0;i<o.length;++i)o[i]=n;return{width:e,height:t,buf:o}}function e0(e,t){if(e<1)throw new Error("Radius is less than 1");if(typeof t=="string"&&(t=parseInt(t,32)),!ze(t))throw new Error("That color is invalid!");let n=new Uint8Array(e*e),o=e*.5;for(let i=0;i<e;++i)for(let s=0;s<e;++s)n[i*e+s]=Ie(i-(o-.5),s-(o-.5))<=o+1?t:255;return{buf:n,height:e,width:e}}function t0(e){let t=new Uint8Array(8+e.width*e.height),n=new Uint32Array(t.buffer);n[0]=e.width,n[1]=e.height;for(let o=0;o<e.height;++o)for(let i=0;i<e.width;++i)t[o*e.width+i+8]=e.buf[o*e.width+i];return t}function n0(e){let t=new Uint8Array(e.length-8),n={height:0,width:0,buf:t},o=new Uint32Array(e.buffer);n.width=o[0],n.width=o[1];for(let i=0;i<n.height;++i)for(let s=0;s<n.width;++s)t[i*n.width+s]=n.buf[i*n.width+s+8];return n}var Q=!1;function $e(){Q=!1}function Ve(){Q=!0}var Ze=class{constructor(){this.name="ImageRenderer"}init(){}update(t,n,o){if(o.image.width<1||o.image.height<1)return;let i=o.image;o.mask&&o.mask.width===i.width&&o.mask.height===i.height&&(i=ue(i,o.mask)),Y(o.transform.position.x,o.transform.position.y,i)}},ce=new Ze;var Te={a:r("4:5:01101001111110011001"),b:r("4:5:11101001111010011110"),c:r("3:5:011100100100011"),d:r("4:5:11101001100110011110"),e:r("3:5:111100110100111"),f:r("3:5:111100110100100"),g:r("4:5:01111000101110010110"),h:r("4:5:10011001111110011001"),i:r("3:5:111010010010111"),j:r("4:5:11110001000110010110"),k:r("3:5:101101110101101"),l:r("3:5:100100100100111"),m:r("5:5:1000111011101011000110001"),n:r("5:5:1000111001101011001110001"),o:r("4:5:01101001100110010110"),p:r("4:5:11101001111010001000"),q:r("4:5:01101001100110110111"),r:r("4:5:11101001111010101001"),s:r("4:5:01111000011000011110"),t:r("3:5:111010010010010"),u:r("4:5:10011001100110010110"),v:r("3:5:101101101101010"),w:r("5:5:1000110001101011010101010"),x:r("3:5:101101010101101"),y:r("3:5:101101010010010"),z:r("3:5:111001010100111"),"\xB4":r("2:5:0110000000"),"`":r("2:5:1001000000"),"^":r("4:5:01101001000000000000"),1:r("3:5:010110010010111"),2:r("4:5:01101001001001001111"),3:r("4:5:01101001001010010110"),4:r("4:5:10001010111100100010"),5:r("4:5:11111000111000011110"),6:r("4:5:01101000111010010110"),7:r("4:5:11110001001001000100"),8:r("4:5:01101001011010010110"),9:r("4:5:01101001011100010001"),0:r("4:5:01101011101111010110"),"[":r("2:5:1110101011"),"]":r("2:5:1101010111"),"(":r("2:5:0110101001"),")":r("2:5:1001010110"),"\\":r("2:5:1010100101"),"/":r("2:5:0101011010"),"<":r("2:5:0001100100"),">":r("2:5:0010011000"),"-":r("3:5:000000111000000"),"*":r("3:5:101010101000000"),"+":r("3:5:000010111010000"),\u03C0:r("5:5:0000011111010100101010010"),":":r("1:5:01010"),"=":r("3:5:000111000111000"),".":r("1:5:00001"),"!":r("1:5:11101"),"?":r("4:5:01101001001000000010"),"{":r("3:5:001010110010001"),"}":r("3:5:100010011010100"),"#":r("5:5:0101011111010101111101010"),'"':r("3:5:101101000000000"),"%":r("3:5:101001010100101"),"'":r("1:5:11000"),";":r("1:5:01011"),"&":r("4:5:01111000010110100101"),$:r("5:5:0111110100011100010111110"),"@":r("5:5:0111010001101111000001111"),"\u2190":r("4:5:00000100111101000000"),"\u2192":r("4:5:00000010111100100000"),"\u2191":r("3:5:010111010010000"),"\u2193":r("3:5:000010010111010"),"\u221A":r("5:5:0000000001000101010001000"),"\u2715":r("5:5:1000101010001000101010001")};var lt={a:r("5:5:0110010010111101001010010"),b:r("5:5:1110010010111001001011100"),c:r("5:5:0011001000010000100000110"),d:r("5:5:1110010010100101001011100"),e:r("5:5:0111001000011000100001110"),f:r("5:5:1110010000110001000010000"),g:r("5:5:0111010000101101001001100"),h:r("5:5:1001010010111101001010010"),i:r("5:5:0111000100001000010001110"),j:r("5:5:1111000010000101001001100"),k:r("5:5:0101001010011000101001010"),l:r("5:5:0100001000010000100001110"),m:r("5:5:1000111011101011000110001"),n:r("5:5:1000111001101011001110001"),o:r("5:5:0110010010100101001001100"),p:r("5:5:1110010010111001000010000"),q:r("5:5:0110010010100101011001110"),r:r("5:5:1110010010111001010010010"),s:r("5:5:0111010000011000001011100"),t:r("5:5:0111000100001000010000100"),u:r("5:5:1001010010100101001001100"),v:r("5:5:0101001010010100101000100"),w:r("5:5:1000110001101011010101010"),x:r("5:5:0101001010001000101001010"),y:r("5:5:0101001010001000010000100"),z:r("5:5:0111000010001000100001110"),"\xB4":r("5:5:0010001000000000000000000"),"`":r("5:5:0100000100000000000000000"),"^":r("5:5:0110010010000000000000000"),1:r("5:5:0010001100001000010001110"),2:r("5:5:0110010010001000100011110"),3:r("5:5:0110010010001001001001100"),4:r("5:5:1000010100111100010000100"),5:r("5:5:1111010000111000001011100"),6:r("5:5:0110010000111001001001100"),7:r("5:5:1111000010001000100001000"),8:r("5:5:0110010010011001001001100"),9:r("5:5:0110010010011100001000010"),0:r("5:5:0110010110101101101001100"),"[":r("5:5:0011000100001000010000110"),"]":r("5:5:0110000100001000010001100"),"(":r("5:5:0001000100001000010000010"),")":r("5:5:0100000100001000010001000"),"\\":r("5:5:0100001000010000010000100"),"/":r("5:5:0001000010000100010000100"),"<":r("5:5:0000000010001000001000000"),">":r("5:5:0000001000001000100000000"),"-":r("5:5:0000000000011100000000000"),"*":r("5:5:0101000100010100000000000"),"+":r("5:5:0000000100011100010000000"),\u03C0:r("5:5:0000011111010100101010010"),":":r("5:5:0000000100000000010000000"),"=":r("5:5:0000001110000000111000000"),".":r("5:5:0000000000000000000001000"),"!":r("5:5:0100001000010000000001000"),"?":r("5:5:0110010010001000000000100"),"{":r("5:5:0001000100011000010000010"),"}":r("5:5:0100000100001100010001000"),"#":r("5:5:0101011111010101111101010"),'"':r("5:5:0101001010000000000000000"),"%":r("5:5:0101000010001000100001010"),"'":r("5:5:0010000100000000000000000"),";":r("5:5:0000000100000000010000100"),"&":r("5:5:0111010000010101010001010"),$:r("5:5:0111110100011100010111110"),"@":r("5:5:0111010001101111000001111"),"\u2190":r("5:5:0000000100011110010000000"),"\u2191":r("5:5:0010001110001000010000000"),"\u2192":r("5:5:0000000010011110001000000"),"\u2193":r("5:5:0000000100001000111000100"),"\u221A":r("5:5:0000000001000101010001000"),"\u2715":r("5:5:1000101010001000101010001")};var ut={a:r("5:5:0010001010011101000110001"),b:r("5:5:1110010010111001001011100"),c:r("5:5:0110010010100001001001100"),d:r("5:5:1110010010100101001011100"),e:r("5:5:1111010000111001000011110"),f:r("5:5:1111010000111001000010000"),g:r("5:5:0111010000101101001001110"),h:r("5:5:1001010010111101001010010"),i:r("5:5:0010000100001000010000100"),j:r("5:5:1111010000100001001001100"),k:r("5:5:1001010100110001010010010"),l:r("5:5:1000010000100001000011110"),m:r("5:5:1101110101100011000110001"),n:r("5:5:1000111001101011001110001"),o:r("5:5:0111010001100011000101110"),p:r("5:5:1110010010111001000010000"),q:r("5:5:0110010010100101001001101"),r:r("5:5:1110010010111001001010010"),s:r("5:5:0111010000011000001011100"),t:r("5:5:1111100100001000010000100"),u:r("5:5:1000110001100011000101110"),v:r("5:5:1000110001010100101000100"),w:r("5:5:1000110101101011111101010"),x:r("5:5:1001010010011001001010010"),y:r("5:5:1010010100111000100001000"),z:r("5:5:1111100010001000100011111"),":":r("5:5:0100001000000000100001000"),0:r("5:5:0110010110110101001001100"),1:r("5:5:0010001100001000010001110"),2:r("5:5:0110010010001000100011110"),3:r("5:5:0111000010011100001001110"),4:r("5:5:1000010100111100010000100"),5:r("5:5:0111001000011100001001110"),6:r("5:5:1111010000111101001011110"),7:r("5:5:1111000010001000100001000"),8:r("5:5:0110010010011001001001100"),9:r("5:5:1111010010111100001011110"),"-":r("5:5:0000000000011100000000000"),"+":r("5:5:0000000100011100010000000"),"!":r("5:5:0010000100001000000000100"),'"':r("5:5:0101001010000000000000000"),"#":r("5:5:0101011111010101111101010"),$:r("5:5:0111110100011100010111110"),"%":r("5:5:1000100010001000100010001"),"&":r("5:5:1110011000111101010001100"),"'":r("5:5:0010000100000000000000000"),"*":r("5:5:1010101110111110111010101"),",":r("5:5:0000000000000000100010000"),".":r("5:5:0000000000000000000010000"),"/":r("5:5:0000100010001000100010000"),";":r("5:5:0000000100000000010001000"),"<":r("5:5:0001101100100000110000011"),">":r("5:5:1100000110000010011011000"),"=":r("5:5:0000011111000001111100000"),"?":r("5:5:0111000010001100000000100"),"[":r("5:5:0111001000010000100001110"),"]":r("5:5:0111000010000100001001110")};var De=class{constructor({image:t,name:n,components:o,mask:i,opacity:s,transform:a,customRenderer:l}){this.components={};this.componentInitData={};this.componentData={};typeof t=="string"?this.image=He(t):this.image=t,this.name=n,this.opacity=s===void 0?1:s,this.hasCustomRenderer=!!l,typeof i=="string"?this.mask=r(i):typeof i=="object"&&i&&(this.mask=i),this.transform={position:{x:a?.position?.x||0,y:a?.position?.y||0}},this.active=!0,o&&this.addComponents(o),this.hasCustomRenderer||this.addComponents([{component:ce}])}addComponents(t){for(let n=0;n<t.length;++n)this.components[t[n].component.name]||(this.componentData[t[n].component.name]=t[n].component.init(t[n].config,this),this.components[t[n].component.name]=t[n].component,this.componentInitData[t[n].component.name]=t[n].config)}removeComponent(t){this.components[t]?.remove?.(this.componentData[t],this),delete this.components[t],delete this.componentData[t],delete this.componentInitData[t]}getComponent(t){return this.components[t]}remove(){let t=Object.keys(this.components);for(let n=0;n<t.length;++n)this.components[t[n]]?.remove?.(this.componentData[t[n]],this)}init(){let t=Object.keys(this.components);for(let n=0;n<t.length;++n)this.componentData[t[n]]=this.components[t[n]]?.init(this.componentInitData[t[n]],this);this.hasCustomRenderer||this.addComponents([{component:ce}])}render(t){if(!this.active)return;D&&(m["Update State"]="GameObject::"+this.name);let n=Object.keys(this.components);for(let o=0;o<n.length;++o)this.components[n[o]]?.update?.(this.componentData[n[o]],t,this)}};function ct(e,t){return{component:e,config:t}}function ft(e,t){let n=JSON.stringify(e);localStorage.setItem("saveFile."+fe()+(t?":"+t:""),n)}function dt(e){if(localStorage.getItem("saveFile."+fe()+(e?":"+e:"")))return JSON.parse(localStorage.getItem("saveFile."+fe()+(e?":"+e:""))||"{}")}var Se=class{constructor(t){this.objects=[];this.uScene=t,this.name=t.name,this.config={}}init(){this.objects=[...this.uScene.gameObjects],this.config=this.uScene.beforeInit(this);for(let t=0;t<this.objects.length;++t)this.objects[t].init();this.uScene.afterInit?.(this.config,this)}remove(){this.uScene.beforeRemove?.(this.config,this);for(let t=0;t<this.objects.length;++t)this.objects[t].remove();this.objects=[],this.uScene.afterRemove?.(this.config,this),this.config={}}update(t){this.uScene.beforeUpdate?.(this.config,this,t);for(let n=0;n<this.objects.length;++n)this.objects[n].render(t);this.uScene.afterUpdate?.(this.config,this,t)}addObject(t){this.objects.push(t)}objectAmount(){return this.objects.length}},_=[],R=0,ie={setScenes(e,t){_[R]?.remove(),_=e,R=t||0,_[R]?.init()},addScene(e){_.push(e)},changeScene(e){if(typeof e=="number")_[R]?.remove(),R=e,_[R]?.init();else{let t=-1;for(let n=0;n<_.length;++n)if(_[n].name===e){t=n;break}if(t<0)throw new Error("No scene with the name "+e+" was found!");_[R]?.remove(),R=t,_[R]?.init()}},update(e){D&&(m["Update State"]="Scene"),_[R]?.update(e),D&&(m["Current Scene"]=_[R]?_[R].name:"None",m["#Game Objects"]=_[R]?.objectAmount().toString()||"0")},getScene(){return _[R]}};var mt=Te;var q={...mt};function ht(e,t,n,o,{spaceWidth:i,centered:s=!1}={}){let a=[],l=t;i||=5;let u=Math.min(o-t,se(e,i)),c=s?e.split(`
`).map(E=>Math.floor((se(E,i)-u)/2)):[];i++,c[0]&&s&&(t+=c[0]);let g=0,d=0;for(let E=0;E<e.length;++E){if((t>o||e[E]===`
`)&&(a.push({y:n,start:l+(c[g]||0),end:l+(c[g]||0)+d-1}),t=l,s&&c[++g]&&(t+=c[g]),n+=6,e[E]===`
`))continue;if(e[E]===" "){d+=i,t+=i;continue}let M=q[e[E].toLowerCase()];if(!M){d+=6,t+=6;continue}d+=M.width+1,t+=M.width+1}return a.push({y:n,start:l,end:l+d-1}),a}function se(e,t){let n=0;t||=5,t++;let o=0;for(let i=0;i<e.length;++i){if(e[i]===`
`){o>n&&(n=o),o=0;continue}if(e[i]===" "){o+=t;continue}let s=q[e[i].toLowerCase()];if(!s){o+=6;continue}o+=s.width+1}return o>n?o:n}function pt(e,t,n,o,{background:i,color:s,spaceWidth:a,centered:l=!1}={}){a||=5;let u=[],c=Math.min(o-t,se(e,a)),g=l?e.split(`
`).map(T=>Math.max(Math.floor((c-se(T,a))/2),0)):[];l&&(t=Math.max(0,t-Math.floor(c/2))),a++;let d=0;s||=0;let E=t;l&&g[0]&&(t+=g[0]);let M=[C(1,5,s),C(2,5,s),C(3,5,s),C(4,5,s),C(5,5,s)],N=typeof i=="number"?[C(1,5,i),C(2,5,i),C(3,5,i),C(4,5,i),C(5,5,i)]:null,W=typeof i=="number"?C(1,5,i):null,L=0;for(let T=0;T<e.length;++T){if((t>o||e[T]===`
`)&&(u.push({y:n,start:E,end:E+L-1}),t=E,e[T]===`
`&&g[++d]&&(t+=g[d]),n+=6,i&&L>0&&Z(t,n-1,C(L,1,i)),L=0,e[T]===`
`))continue;if(e[T]===" "&&N&&Z(t-1,n,C(7,5,i||0)),e[T]===" "){L+=a,t+=a;continue}let b=q[e[T].toLowerCase()];if(!b&&N&&Z(t,n,C(6,5,i||0)),!b){L+=6,t+=6,console.log('Text: No mask found for "%s"',e[T]);continue}let P=ue(M[b.width-1],b);P&&N?(Z(t,n,N[b.width-1]),Y(t,n,P)):P&&Z(t,n,P),W&&L>0&&Z(t-1,n,W),L+=b.width+1,t+=b.width+1}return u.push({y:n,start:E,end:E+L-1}),u}function gt(e,t){if(t.width<1||t.width>5||t.height!==5)throw new Error("The mask has to be 5 high and between 1 and 5 long");if(e.length!==1)throw new Error("The character has to be 1 long");q[e]=t}function bt(e){let t=Object.keys(e);for(let n=0;n<t.length;++n){let o=e[t[n]];typeof o=="string"&&(o=r(o)),q[t[n]]=o}}function wt(){let e=Object.keys(q);for(let t=0;t<e.length;++t)delete q[e[t]]}var f=[];function vt(e,t,n,o,i,s,a){return f.push({end:e<0?-1:Date.now()+e,force:s,gravity:i,image:C(n,n,o),pos:t,fallsOOB:!!a}),f[f.length-1]}function Xe(e){return e.pos.x<0||e.pos.x>I||e.pos.y<0||e.pos.y>S?!0:e.end>=0?Date.now()>e.end:Math.abs(e.force.y)<.1&&e.pos.y===S-e.image.height}var yt=0;function xt(e){yt!==f.length&&Ve(),yt=f.length;let t=0;for(let n=0;n<f.length;++n){if(Xe(f[n])){if(n===0){for(;f[0]&&Xe(f[0]);)f.shift();n=-1}else if(n===f.length-1)for(;f[0]&&Xe(f[f.length-1]);)f.pop();continue}f[n].force.y+=f[n].gravity*(.1*e),f[n].pos.y+=f[n].force.y,f[n].pos.x+=f[n].force.x,!f[n].fallsOOB&&f[n].pos.y+f[n].image.height>=S&&(f[n].pos.y=S-f[n].image.height,f[n].force.y*=-.7),!f[n].fallsOOB&&f[n].pos.y<0&&(f[n].pos.y=0,f[n].force.y*=-.7),!f[n].fallsOOB&&f[n].pos.x+f[n].image.width>=I&&(f[n].force.x*=-1,f[n].pos.x=I-f[n].image.width),!f[n].fallsOOB&&f[n].pos.x<0&&(f[n].force.x*=-1,f[n].pos.x=0),t++,Y(f[n].pos.x,f[n].pos.y,f[n].image)}D&&(m.Particles=f.length.toString(),m["Particles (visisble)"]=t.toString())}function Et(e){e.end=0}function It(){for(;f.length>0;)f.pop()}function h(e,t){globalThis[e]=t}function Ct(){h("fonts",{default:Te,default_monospace:lt,legacy:ut}),h("imageUtils",We),h("nextFrame",()=>new Promise(t=>requestAnimationFrame(()=>t()))),h("ImageRenderer",ce),h("createComponent",ct),h("GameObject",De),h("memory",x),h("isPressed",Tt),h("buttons",de),h("WIDTH",I),h("HEIGHT",S),h("stopGame",z),h("distance",Ie),h("lerp",st),h("storeToFile",ft),h("readFromFile",dt),h("Scene",Se),h("SceneManager",ie),h("writeText",pt),h("currentTextMasks",q),h("addCharacterMask",gt),h("applyCharacterMap",bt),h("clearCharacterMap",wt),h("download",we),h("isOnTimeout",nt),h("timeout",rt),h("audioUtils",Oe),h("calculateBounds",ht),h("calculateWidth",se),h("addParticle",vt),h("removeParticle",Et)}var U=["up","down","left","right","u","i","o","p"],I=200,S=180,x=new Uint8Array(1+I*S);function Tt(e){let t=U.indexOf(e);return t===-1?!1:!!(x[0]>>t&1)}function w(e,t){if(!v||!v.isConnected||pe())return;let n=U.indexOf(t);n<0||(x[0]&=255^1<<n,x[0]|=(e?1:0)<<n,F[t]&&(F[t].style.backgroundColor=e?"#15803d":"#171717"))}var D=!1;function At(e){D=e}var de={down:{get down(){return!!(x[0]>>1&1)},press:!1},up:{get down(){return!!(x[0]&1)},press:!1},left:{get down(){return!!(x[0]>>2&1)},press:!1},right:{get down(){return!!(x[0]>>3&1)},press:!1},u:{get down(){return!!(x[0]>>4&1)},press:!1},i:{get down(){return!!(x[0]>>5&1)},press:!1},o:{get down(){return!!(x[0]>>6&1)},press:!1},p:{get down(){return!!(x[0]>>7&1)},press:!1}},F={};window.addEventListener("keydown",e=>{if(!(pe()||!v||!v.isConnected)){if(e.key==="w")w(!0,"up");else if(e.key==="a")w(!0,"left");else if(e.key==="s")w(!0,"down");else if(e.key==="d")w(!0,"right");else if(e.key==="ArrowUp")w(!0,"up");else if(e.key==="ArrowLeft")w(!0,"left");else if(e.key==="ArrowDown")w(!0,"down");else if(e.key==="ArrowRight")w(!0,"right");else if(e.key==="u")w(!0,"u");else if(e.key==="i")w(!0,"i");else if(e.key==="o")w(!0,"o");else if(e.key==="p")w(!0,"p");else if(e.key==="Escape"){if(z(),B())return;F.stop?.classList.add("active"),setTimeout(()=>F.stop?.classList.remove("active"),100)}else if(e.key==="Enter"){if(_e(),B())return;F.start?.classList.add("active"),setTimeout(()=>F.start?.classList.remove("active"),100)}}});window.addEventListener("keyup",e=>{pe()||!v||!v.isConnected||(e.key==="w"?w(!1,"up"):e.key==="a"?w(!1,"left"):e.key==="s"?w(!1,"down"):e.key==="d"?w(!1,"right"):e.key==="ArrowUp"?w(!1,"up"):e.key==="ArrowLeft"?w(!1,"left"):e.key==="ArrowDown"?w(!1,"down"):e.key==="ArrowRight"?w(!1,"right"):e.key==="u"?w(!1,"u"):e.key==="i"?w(!1,"i"):e.key==="o"?w(!1,"o"):e.key==="p"&&w(!1,"p"))});var A=null,ae=Date.now(),Dt=new Uint8Array([0]),he=!1,Ae=[];function kt(e){for(let n=0;n<I*S;++n)x[n+1]=255;let t=Date.now();if(he||!v||!v.isConnected||!ke)return he=!1;if(X){Le("beforeRender",[A,e-ae]),D&&(m["Update State"]="Buttons");for(let n=0;n<U.length;n++)de[U[n]].press=!!(x[0]>>n&1&&!(Dt[0]>>n&1));if(A&&!pe()){$e(),D&&(m["Update State"]="Global"),X.update?.(e-ae),D&&(m["Update State"]="Particles"),xt(e-ae),ie.update(e-ae),D&&(m["Update State"]="Screen");let n=new Uint8ClampedArray(I*S*4);if(Q){A.clearRect(0,0,I,S);for(let o=0;o<S;++o)for(let i=0;i<I;++i)if(x[o*I+i+1]!==255){let s=je(x[o*I+i+1]),a=(o*I+i)*4;n[a]=s.r,n[a+1]=s.g,n[a+2]=s.b,n[a+3]=s.a}A.putImageData(new ImageData(n,I,S),0,0)}}if(ae=e,Dt[0]=x[0],Ae.push(Date.now()-t),Date.now()-t>30&&console.warn("[Violation] Screen Update took over 30 milliseconds"),requestAnimationFrame(kt),Le("afterRender",[A,e-ae]),!!D){m["Update State"]="Idle",m["Render (ms)"]=Date.now()-t+"ms",m["Buttons Down"]="",m["Buttons Pressed"]="";for(let n=0;n<U.length;++n)de[U[n]].press&&(m["Buttons Pressed"]+=U[n]+" "),de[U[n]].down&&(m["Buttons Down"]+=U[n]+" ");m["Buttons Down"]||="None",m["Buttons Pressed"]||="None",m["Mean Update Time"]=(Ae.reduce((n,o)=>n+o,0)/Ae.length).toFixed(2)+"ms",m["Worst Update Time"]=Ae.reduce((n,o)=>n>o?n:o,0)+"ms"}}}var v=null;function r0(e){let t=document.createElement("div");return t.dataset.type=e,t.style.width="2.5rem",t.style.height="2.5rem",t.style.backgroundColor="#171717",t.style.margin="3px",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.userSelect="none",t.style.cursor="pointer",t.style.fontFamily="sans-serif",t.style.fontWeight="bold",t.classList.add("__rainbow32_button","__rainbow32_button_"+e),t.textContent=e==="down"?"\u2193":e==="left"||e==="up"||e==="right"?"\u2191":e,e==="left"?t.style.transform="rotateZ(-90deg)":e==="right"&&(t.style.transform="rotateZ(90deg)"),t}function St(e){let t=document.createElement("div");return t.dataset.textContent=e,t.style.minWidth="3rem",t.style.height="25px",t.style.backgroundColor="#171717",t.style.padding="0px .5rem",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.userSelect="none",t.style.cursor="pointer",t.style.fontFamily="sans-serif",t.style.fontWeight="bold",t.classList.add("__rainbow32_textbutton"),t}var ke=!1,me=[],m={"Game State":"Uninitialized","Render (ms)":"-1ms","Buttons Down":"None","Buttons Pressed":"None","Game Name":""};function Ke(){let e="",t=Object.keys(m);for(let n=0;n<t.length;++n)m[t[n]].length>0&&(e+=`${t[n]}: ${m[t[n]]}
`);return e}async function wn(){Be(),await z();for(let e of me)e();me=[];for(let e of U)F[e]=void 0;F.start=void 0,F.stop=void 0,v?.isConnected&&v.remove(),X=null,ke=!1,D&&(m["Game State"]="Uninitialized")}async function Lt(e,t,n){if(ke)throw new Error("onLoad(...) was already called! call unload(...) first!");ke=!0,e||(e=document.body),t===void 0&&(t=!0),B()&&(t=!1),v&&v.remove(),v=e;let o=n?.({canvas:{aspectRatio:"200/180",bgCol:"var(--bg-col)",height:B()||!t?"100%":"50%",zIndex:10},classes:{canvas:"__rainbow32_canvas",fileInput:"__rainbow32_gamefile",buttons:{down:"__rainbow32_button_down",right:"__rainbow32_button_right",up:"__rainbow32_button_up",left:"__rainbow32_button_left",i:"__rainbow32_button_i",o:"__rainbow32_button_o",u:"__rainbow32_button_u",p:"__rainbow32_button_p",start:"__rainbow32_button_start",stop:"__rainbow32_button_stop"},button:"__rainbow32_button",textButton:"__rainbow32_textbutton"},withControls:!B()&&t,frame:e}),i=o?.canvas?o.canvas:document.createElement("canvas");if(i.width=200,i.height=180,i.isConnected||e.append(i),o?.canvas||(B()||!t?i.style.height="100%":i.style.height="50%",i.style.margin="0 auto",i.style.aspectRatio="200/180",i.style.width="auto",i.style.imageRendering="pixelated",i.style.backgroundColor="var(--bg-col)",i.style.zIndex="10"),A=i.getContext("2d",{willReadFrequently:!0}),!A)return console.error("Error: Could not initialize 2d context");A.imageSmoothingEnabled=!1;function s(a){if(!(!v||!v.isConnected)&&a.key==="F2"&&!B()){a.preventDefault();let l=new Date;we(i.toDataURL(),`screenshot-${l.getFullYear()}-${l.getMonth()}-${l.getDay()+1}-${l.getHours()}-${l.getSeconds()}-${l.getMilliseconds()}.png`)}}if(window.addEventListener("keydown",s),me.push(()=>window.removeEventListener("keydown",s)),B()||!t){let a=document.createElement("div");for(let l of U)F[l]=a,o?.buttons?.[l]?.remove();F.start=a,F.stop=a}else for(let a of U){let u=function(d){w(!0,a),d.preventDefault()},c=function(){w(!1,a)},g=function(d){d.pressure>0&&(w(!0,a),d.preventDefault())},l=o?.buttons?.[a]?o.buttons[a]:r0(a);l.dataset.type=a,F[a]=l,l.isConnected||e.append(l),l.addEventListener("pointerdown",u),l.addEventListener("contextmenu",u),l.addEventListener("pointerover",g),l.addEventListener("pointerenter",g),l.addEventListener("pointerup",c),l.addEventListener("pointerleave",c),l.addEventListener("pointerout",c),l.addEventListener("pointercancel",c),me.push(()=>{l.addEventListener("pointerdown",u),l.addEventListener("contextmenu",u),l.addEventListener("pointerover",g),l.addEventListener("pointerenter",g),l.addEventListener("pointerup",c),l.addEventListener("pointerleave",c),l.addEventListener("pointerout",c),l.addEventListener("pointercancel",c)})}if(!B()&&t){let a=o?.fileInput?o.fileInput:document.createElement("input");o?.fileInput&&(a.type="file",a.name="game-file",a.id="__rainbow32_gamefile",a.classList.add("__rainbow32_gamefile"),a.style.display="none"),a.addEventListener("change",Je);let l=o?.buttons?.start?o.buttons.start:St("Start"),u=o?.buttons?.stop?o.buttons.stop:St("Reset");o?.buttons?.start||l.classList.add("__rainbow32_button_start"),o?.buttons?.stop||l.classList.add("__rainbow32_button_stop"),a.isConnected||e.append(a),l.isConnected||e.append(l),u.isConnected||e.append(u),l.addEventListener("click",_e),u.addEventListener("click",z),me.push(()=>{a.removeEventListener("change",Je),l.removeEventListener("click",_e),u.removeEventListener("click",z)})}else o?.buttons?.start?.remove(),o?.buttons?.stop?.remove();D&&(m["Game State"]="Idle",Ee())}var X=null,ee={};function Ye(e,t){return ee[e]||=[],ee[e].push(t),()=>ee[e]=ee[e].filter(n=>n!==t)}function Le(e,t){if(ee[e])for(let n=0;n<ee[e].length;++n)try{ee[e][n](...t)}catch(o){console.error("A evenhandler for "+e+` threw an error!
\u2570\u2500> %s`,o)}}async function _t(e){await Ee(),D&&(m["Game State"]="Running",m["Game Name"]=e.name),!(!v||!v.isConnected)&&(X=e,A?.canvas.setAttribute("style","--bg-col: "+e.bg+"; "+(A.canvas.getAttribute("style")?.replace(/--bg-col: *(#[0-9a-f]+|rgba?\(( *[0-9]+,? *)+\))/,"")||"")),e.palette&&Ne(e.palette),e?.init?.(),e.scenes&&ie.setScenes(e.scenes,e.defaultScene),Le("afterLoad",[e]),requestAnimationFrame(kt))}function z(){return It(),D&&(m["Game State"]="Idle",m["Game Name"]=""),he=!0,X?(X.remove?.(),ie.setScenes([]),X=null,A&&A.clearRect(0,0,A.canvas.width,A.canvas.height),A?.canvas.setAttribute("style","--bg-col: #fff; "+(A.canvas.getAttribute("style")?.replace(/--bg-col: *(#[0-9a-f]+|rgba?\(( *[0-9]+,? *)+\))/,"")||"")),Le("afterStop",[]),new Promise(e=>requestAnimationFrame(e))):new Promise(e=>e())}async function Je(ev){if(!v||!v.isConnected)return;await z();let el=ev.target;if(!el.files||!el.files.item(0))return;let text="",buf=new Uint8Array(await el.files.item(0).arrayBuffer());if(el.files.item(0).name.endsWith(".png")){let e=buf[buf.length-1]|buf[buf.length-2]<<8|buf[buf.length-3]<<16|buf[buf.length-4]<<24;for(let t=e;t<buf.length-4;++t)text+=String.fromCharCode(buf[t])}else for(let e=0;e<buf.length;++e)text+=String.fromCharCode(buf[e]);if(text){try{if(await async function(){await eval(text)}(),!globalThis.__registeredGame)throw new Error;let game=globalThis.__registeredGame;if(!game)throw new Error;delete globalThis.__registeredGame,console.log("Loading Game %s",game?.name||"no name specified",game),he=!1,_t(game)}catch(e){console.error(`Could not load file!
\u2570\u2500> %s`,e)}delete globalThis.__registeredGame}}window.stopGame=z;window.loadGame=Je;async function Me(contents){if(!(!v||!v.isConnected)&&(await z(),!!contents)){try{if(await async function(){await eval(contents)}(),!globalThis.__registeredGame)throw new Error;let game=globalThis.__registeredGame;if(!game)throw new Error;delete globalThis.__registeredGame,console.log("Loading Game %s",game?.name||"no name specified",game),he=!1,_t(game)}catch(e){console.error(`Could not load file!
\u2570\u2500> %s`,e)}delete globalThis.__registeredGame}}function fe(){return X?.name||""}window.getCurrentGameName=fe;Ct();function _e(){!v||!v.isConnected||Mt()||v.getElementsByClassName("__rainbow32_gamefile")[0]?.click()}window.startGame=_e;window.loadGameByContents=Me;var k=window.electron?.ipcRenderer;function ge(e){let t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",e),t}function o0(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","1rem"),e.setAttribute("height","1rem"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke","currentColor"),e.setAttribute("fill","none"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round");let t=ge("M0 0h24v24H0z");return t.setAttribute("stroke","none"),t.setAttribute("fill","none"),e.append(t,ge("M14 3v4a1 1 0 0 0 1 1h4"),ge("M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z")),e}function i0(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","1rem"),e.setAttribute("height","1rem"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke","currentColor"),e.setAttribute("fill","none"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round");let t=ge("M0 0h24v24H0z");return t.setAttribute("stroke","none"),t.setAttribute("fill","none"),e.append(t,ge("M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2")),e}function te(e,t,n){let o=document.createElement("p");o.classList.add("fileselect"),t&&o.classList.add("active"),o.append(document.createTextNode(t?"\u25B6 ":"\xA0\xA0")),n!==void 0&&o.append(n?o0():i0());let i=document.createElement("span");return i.textContent=e,o.append(i),o}var be=[],p=0,y=null,O=[],j=[],ne;k?.getCartridges().then(e=>{ne=e,y==="cartridges"&&$()});function Rt(){let e=document.createElement("div");e.classList.add("fileSelector");let t=document.createElement("p");if(t.classList.add("path"),t.textContent=(y?y==="home"?"home":y==="/"?"":y==="cartridges"?"cartridges":"/mnt/"+y:"")+"/"+O.join("/"),e.append(t),y)if(y==="cartridges")if(e.append(te(".. (Go Up)",p===0,void 0)),ne)for(let n=0;n<ne.length;++n){let o=document.createElement("div");o.classList.add("cartridge"),e.append(o),o.setAttribute("style",'--img: url("'+ne[n]+'");'),o.setAttribute("b64",ne[n].substring(22)),e.append(o)}else{let n=te("Loading...",!1,void 0);e.append(n)}else for(let n=0;n<j.length;++n)e.append(te(j[n].name,p===n,j[n].file));else{e.append(te("/ (Root)",p===0,void 0),te("home",p===1,void 0),te("cartridges",p===2,void 0));for(let n=0;n<be.length;++n)e.append(te(be[n],p===n+3,void 0))}return e}var V=Rt();function $(){let e=Rt();V.parentNode?.append(e),V.remove(),V=e}var Re;function Mt(){return k?(Re=!0,V.parentElement||(document.body.append(V),y=null,k.getDevices().then(e=>{be=e,$()}),O=[],p=0,x[0]=0),!0):!1}function pe(){return k?Re:!1}function Ge(){k&&(Re=!1,V.remove())}function Ft(){if(k)if(y)O.length<1||y==="cartridges"?(y!=="/"&&y!=="home"&&y!=="cartridges"&&k.unmountDevice(y),y=null,p=0,$()):(O.pop(),k.listDirectory(y,"/"+O.join("/")).then(e=>{e&&(j=e,p=0,$())}));else return Ge()}function Gt(e){let t=0;y==="cartridges"?t=ne?ne?.length+1:1:y?t=j.length:t=be.length+2;let n=0;e?n=(p===0?t:p)-1:n=p===t-1?0:p+1;let o=V.children[p+1];if(o&&(o.classList.remove("active"),o.classList.contains("fileselect")&&(o.childNodes[0].data="\xA0\xA0")),t===0)return;n<0?p=0:n>=t?p=t-1:p=n;let i=V.children[p+1];i&&(i.classList.add("active"),i.scrollIntoView({behavior:"auto",block:"center"}),i.classList.contains("fileselect")&&(i.childNodes[0].data="\u25B6 "))}function s0(){if(!k)return;if(y==="cartridges"){if(p===0)return Ft();let t=V.children[p+1];if(!t)return;let n=t.getAttribute("b64");if(!n)return;fetch("data:application/octet-stream;base64,"+n).then(o=>o.arrayBuffer()).then(o=>new Uint8Array(o)).then(o=>{let i=o[o.length-1]|o[o.length-2]<<8|o[o.length-3]<<16|o[o.length-4]<<24,s="";for(let a=i;a<o.length-4;++a)s+=String.fromCharCode(o[a]);return console.log(s),Ge(),Me(s).catch(()=>{})})}if(y){let t=j[p];if(!t)return;if(t.file){k.getFileContents(y,O.join("/")+"/"+t.name).then(n=>{n&&(Me(n).catch(()=>{}),Ge())});return}O.push(t.name),k.listDirectory(y,"/"+O.join("/")).then(n=>{n&&(j=n,p=0,$())});return}if(p===0){k.listDirectory("/","/").then(t=>{t&&(y="/",j=t,O=[],p=0,$())});return}if(p===1){k.listDirectory("home","/").then(t=>{t&&(y="home",j=t,O=[],p=0,$())});return}if(p===2)return y="cartridges",j=[],O=[],p=0,$();let e=be[p-3];e&&k.mountDevice(e).then(()=>k.listDirectory(e,"/")).then(t=>{t&&(y=e,j=t,O=[],p=0,$())})}window.addEventListener("load",()=>{function e(t){!Re||!k||(t.key==="ArrowDown"||t.key==="s"?(Gt(!1),t.preventDefault()):t.key==="ArrowUp"||t.key==="w"?(Gt(!0),t.preventDefault()):t.key==="ArrowRight"||t.key==="a"?(s0(),t.preventDefault()):t.key==="ArrowLeft"||t.key==="d"?(Ft(),t.preventDefault()):t.key==="Escape"&&(Ge(),t.preventDefault()))}window.addEventListener("keydown",e)});function B(){return!!globalThis.__console_config_canvasFullScreen}var Qe;function J(e,t){let n=document.createElement("div");return n.style.width="2.5rem",n.style.height="2.5rem",n.style.backgroundColor="#171717",n.style.margin="3px",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.userSelect="none",n.style.cursor="pointer",n.style.fontWeight="bold",n.classList.add(...e),n.textContent=t==="down"?"\u2193":t==="left"||t==="up"||t==="right"?"\u2191":t,t==="left"?n.style.transform="rotateZ(-90deg)":t==="right"&&(n.style.transform="rotateZ(90deg)"),n}function Pt(e){let t=document.createElement("div");return t.textContent=e,t.style.minWidth="3rem",t.style.height="25px",t.style.backgroundColor="#171717",t.style.padding="0px .5rem",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.userSelect="none",t.style.cursor="pointer",t.style.fontWeight="bold",t.classList.add("__rainbow32_textbutton"),t}function a0(e){let t=document.createElement("div"),n=document.createElement("canvas");if(n.style.height=e.canvas.height,n.style.aspectRatio=e.canvas.aspectRatio,n.style.backgroundColor=e.canvas.bgCol,n.style.zIndex=e.canvas.zIndex.toString(),n.style.width="auto",n.style.position="absolute",n.style.top="0px",n.style.bottom="0px",n.style.left="0px",n.style.right="0px",n.style.imageRendering="pixelated",n.style.margin="0px auto",n.classList.add(e.classes.canvas),e.frame.append(n),!e.withControls)return{canvas:n,fileInput:document.createElement("input"),buttons:{down:t,i:t,left:t,o:t,p:t,right:t,start:t,stop:t,u:t,up:t}};let o=document.createElement("div");e.frame.append(o),o.classList.add("content");let i=document.createElement("h1");Qe=i,i.classList.add("gameTitle"),i.textContent="No game loaded!";let s=document.createElement("div");s.classList.add("buttons");let a=document.createElement("div");a.classList.add("moveBtns");let l=J([e.classes.button,e.classes.buttons.up],"up"),u=document.createElement("div");u.style.display="flex";let c=J([e.classes.button,e.classes.buttons.left],"left");c.style.marginRight="calc(2.5rem + 9px)";let g=J([e.classes.button,e.classes.buttons.right],"right");u.append(c,g);let d=J([e.classes.button,e.classes.buttons.down],"down");a.append(l,u,d);let E=document.createElement("div"),M=document.createElement("div");M.style.display="flex",M.style.marginLeft="15px";let N=document.createElement("div");N.style.display="flex",E.append(M,N),s.append(a,E);let W=J([e.classes.button,e.classes.buttons.u],"u"),L=J([e.classes.button,e.classes.buttons.i],"i"),T=J([e.classes.button,e.classes.buttons.o],"o"),b=J([e.classes.button,e.classes.buttons.p],"p");M.append(W,L),N.append(T,b);let P=document.createElement("input");P.classList.add(e.classes.fileInput),P.id=e.classes.fileInput,P.name=e.classes.fileInput,P.type="file",P.style.display="none";let Fe=Pt("Start");Fe.classList.add(e.classes.textButton,e.classes.buttons.start);let Pe=Pt("Stop");return Pe.classList.add(e.classes.textButton,e.classes.buttons.stop),o.append(i,s,P,Fe,Pe),{canvas:n,buttons:{up:l,down:d,left:c,right:g,u:W,i:L,o:T,p:b,start:Fe,stop:Pe},fileInput:P}}window.addEventListener("load",()=>{Lt(document.body,!0,a0);let e=document.createElement("div");e.classList.add("debug-data"),e.style.display="none";let t=document.createElement("h3");t.textContent="Debug Data";let n=document.createElement("pre");n.textContent=Ke(),e.append(t,n);let o=Date.now();function i(s){n.textContent=Ke(),n.textContent+="FPS: "+(1e3/(s-o)).toFixed(0),requestAnimationFrame(i),o=s}requestAnimationFrame(i),document.body.append(e),document.addEventListener("keydown",s=>{s.key==="F6"&&(e.style.display=e.style.display==="none"?"block":"none",At(e.style.display!=="none"))}),B()?(document.body.style.cursor="none",document.body.style.height="100vh"):(document.body.style.cursor="",document.body.style.height="")});Ye("afterLoad",e=>Qe.textContent=e.name);Ye("afterStop",()=>Qe.textContent="No game loaded!");})();
//# sourceMappingURL=index.js.map
</script>
        <style>@font-face{font-family:pixeloid;src:url(./pixeloid.ttf);}:root{--font:pixeloid,monospace;}*{margin:0;padding:0;font-family:var(--font);user-select:none;}body{background-color:#262626;width:100%;height:100%;}:root{--bg-col:#fff;}.content{margin-top:51vh;color:#fff;height:49vh;width:100%;display:flex;flex-direction:column;align-items:center;}.moveBtns{display:flex;flex-direction:column;align-items:center;}.buttons{display:flex;align-items:center;gap:25px;margin-bottom:3rem;}.__rainbow32_textbutton{height:25px;background-color:#171717;margin:3px;display:flex;align-items:center;justify-content:center;user-select:none;cursor:pointer;font-family:var(--font);font-weight:bold;padding:0px 0.5rem;min-width:3rem;}.__rainbow32_textbutton:active,.__rainbow32_textbutton.active{background-color:#15803d;}.fileselect{user-select:none;width:fit-content;white-space:pre;font-family:monospace;text-overflow:ellipsis;width:25vw;overflow:hidden;display:flex;align-items:center;margin-block-start:0em;margin-block-end:0em;padding:0px 0.5rem;}.fileselect>span{text-overflow:ellipsis;overflow:hidden;}.fileselect.active>span{text-decoration:underline;}.cartridge{width:50%;aspect-ratio:128/150;background-image:var(--img);background-size:contain;box-sizing:border-box;image-rendering:pixelated;}.cartridge.active{background-color:#15803d;}.fileSelector{padding-top:0px;overflow:hidden;width:auto;height:100vh;aspect-ratio:200/180;position:absolute;top:0px;bottom:0px;left:0px;right:0px;margin:0px auto;z-index:20;background-color:white;}.path{border-bottom:1px solid gray;padding:0.25rem;user-select:none;}.debug-data{color:white;position:absolute;top:0px;left:0px;}canvas{cursor:none;}</style>
        <!--customcode-->
    </head>
    <body></body>
</html>
